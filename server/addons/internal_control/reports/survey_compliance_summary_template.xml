<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Reporte de cumplimiento summary: usa plantilla base -->
    <template id="report_survey_compliance_summary">
        <t t-call="internal_control.survey_base_template">
            <t t-set="report_title" t-value="'Reporte de Cumplimiento Agrupado'"/>
            <t t-set="content_title" t-value="'Resultados de Cumplimiento:'"/>
            <t t-set="report_type" t-value="'compliance_summary'"/>
        </t>
    </template>

    <!-- Template especÃ­fico para el contenido de cumplimiento summary -->
    <template id="survey_compliance_summary_content">
        <div style="padding: 20px; margin-top: 15px; font-size: 11px;">
            <!-- Tabla de cumplimiento (Componente reutilizable) -->
            <t t-call="internal_control.survey_compliance_table"/>

            <!-- Resumen -->
            <div style="background-color: #ecf0f1; padding: 15px; border-radius: 5px; margin-top: 20px;">
                <h4 style="margin-top: 0; color: #2c3e50;">Resumen:</h4>
                <t t-set="total_secciones" t-value="len(docs)"/>
                <t t-set="total_respuestas" t-value="sum(docs.mapped('total_responses'))"/>
                <t t-set="total_cumple" t-value="sum(docs.mapped('cumple_count'))"/>
                <t t-set="total_no_cumple" t-value="sum(docs.mapped('no_cumple_count'))"/>
                <t t-set="total_na" t-value="sum(docs.mapped('na_count'))"/>
                <t t-set="promedio_cumplimiento" t-value="sum(docs.mapped('porcentaje_cumplimiento')) / len(docs) if docs else 0"/>
                
                <p><strong>Total Secciones:</strong> <t t-out="total_secciones"/></p>
                <p><strong>Total Respuestas:</strong> <t t-out="total_respuestas"/></p>
                <p><strong>Total Cumple:</strong> <t t-out="total_cumple"/></p>
                <p><strong>Total No Cumple:</strong> <t t-out="total_no_cumple"/></p>
                <p><strong>Total N/A:</strong> <t t-out="total_na"/></p>
                <p><strong>Promedio de Cumplimiento:</strong> <t t-out="'%.1f' % promedio_cumplimiento"/>%</p>
            </div>

            <!-- Matriz de Riesgo (Componente reutilizable) -->
            <t t-call="internal_control.survey_risk_matrix"/>

            <!-- Footer (Componente reutilizable) -->
            <t t-call="internal_control.survey_footer"/>
        </div>
    </template>
</odoo> 