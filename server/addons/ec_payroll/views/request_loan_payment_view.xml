<?xml version="1.0" encoding="UTF-8"?>
<odoo>
	<data>

		<record model="ir.ui.view" id="request_loan_payment_tree_view">
			<field name="name">request.loan.payment.tree</field>
			<field name="model">request.loan.payment</field>
			<field name="arch" type="xml">
				<tree string="Anticipos">
					<field name="number" />
					<field name="employee_id" />
					<field name="request_date" />
					<field name="state" />
				</tree>
			</field>
		</record>

		<record model="ir.ui.view" id="request_loan_payment_form_view">
			<field name="name">request.loan.payment.form</field>
			<field name="model">request.loan.payment</field>
			<field name="arch" type="xml">
				<form string="Anticipos">
					<header>
						<button name="action_request" type="object"
								string="Solicitar" invisible="state != 'draft'" class="oe_highlight" />
						<button name="create_payment" type="object"
								invisible="state != 'requested'"
								string="Crear Pago" class="oe_highlight" />
						<button name="set_draft" type="object"
								string="Regresar a Borrador" invisible="state != 'requested'" class="oe_highlight" />
						<button name="set_cancel" type="object"
								string="Cancelar" invisible="state != 'done'" class="oe_highlight" />
						<field name="state" widget="statusbar" />
					</header>
					<sheet>
						<div class="oe_button_box" name="button_box">
							<field name="payment_ids" invisible="1" />
							<button type="object" name="action_view_payment"
									invisible="payment_count &lt;= 0"
									class="oe_stat_button" icon="fa-money"
									groups="base.group_user,account.group_account_manager,account.group_account_user,account.group_account_invoice">
								<field name="payment_count" widget="statinfo"
									   string="Pago" />
							</button>
						</div>
						<div class="oe_title">
							<h1>
								<field name="number" />
							</h1>
						</div>
						<group>
							<group>
								<field name="employee_id" options="{'no_create': True, 'no_open': True}" />
								<field name="request_date" />
								<field name="is_accountant" invisible="1" />
							</group>
							<group>
								<field name="accountant_id" options="{'no_create': True, 'no_open': True}"/>
								<field name="request_user_id" options="{'no_create': True, 'no_open': True}" />
							</group>

							<field name="communication" nolabel="1"
								   placeholder="Orden/Referencia de Pago" invisible="state == 'draft'" required="state != 'draft'" readonly="0"/>
						</group>
						<notebook colspan="4">
							<page string="Detalle de Pago">
								<field name="line_ids" nolabel="1">
									<tree editable="button">
										<field name="transaction_id" invisible="1"
											   domain="[('category_id.code', '=', 'EGRE'), ('employee_id', '=', parent.employee_id), ('processed', '=', False)]" />
										<field name="observation" />
										<field name="amount_pending" force_save="1" />
										<field name="amount" sum="Total Pagado" />
									</tree>
									<form>
										<group>
											<field name="transaction_id" readonly="1" />
											<field name="amount_pending" readonly="1" />
											<field name="amount" readonly="1" />
										</group>
									</form>
								</field>
							</page>
						</notebook>
					</sheet>
					<footer>
					</footer>
					<div class="oe_chatter">
						<field name="message_follower_ids" widget="mail_followers" />
						<field name="activity_ids" widget="mail_activity" />
						<field name="message_ids" widget="mail_thread" />
					</div>
				</form>
			</field>
		</record>

		<record model="ir.ui.view"
				id="request_loan_payment_search_view">
			<field name="name">request.loan.payment.search</field>
			<field name="model">request.loan.payment</field>
			<field name="arch" type="xml">
				<search string="Anticipos">
					<field name="number" />
					<field name="employee_id" />
					<field name="request_date" />
					<field name="state" />
					<filter name="state_done" string="Por Pagar" domain="[('state','=','requested')]"/>
				</search>
			</field>
		</record>

		<record model="ir.actions.act_window"
				id="action_request_loan_payment_tree_view">
			<field name="name">Anticipos</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">request.loan.payment</field>
			<!-- <field name="view_type">form</field> -->
			<field name="view_mode">tree,form</field>
			<field name="view_id" ref="request_loan_payment_tree_view" />
		</record>

		<record model="ir.actions.act_window" id="action_request_loan_payment_tree_account_view">
			<field name="name">Solicitud de Pago Anticipo</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">request.loan.payment</field>
			<field name="domain">[('state', '!=', 'draft')]</field>
			<field name="view_mode">tree,form</field>
			<field name="context">{'search_default_state_done': 0}</field>
			<field name="view_id" ref="request_loan_payment_tree_view" />
		</record>

		<menuitem id="request_loan_payment_menu"
				  name="Anticipos"
				  parent="hr_payroll.menu_hr_payroll_payslips"
				  sequence='110'
				  action="action_request_loan_payment_tree_view" />

		<menuitem id="request_loan_payment_account_talent_menu"
				  name="Solicitud de Pago Anticipo"
				  parent="ec_payroll.hr_account_menu"
				  action="action_request_loan_payment_tree_account_view" />

	</data>
</odoo>