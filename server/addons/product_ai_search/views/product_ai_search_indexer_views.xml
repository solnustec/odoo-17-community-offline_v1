<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Formul√°rio do Indexador -->
    <record id="view_product_ai_search_indexer_form" model="ir.ui.view">
        <field name="name">product.ai.search.indexer.form</field>
        <field name="model">product.ai.search.indexer</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button string="üëÄ Previsualizar Productos" name="action_preview_products" type="object" class="btn-info" invisible="indexation_started"/>
                    <button string="üöÄ Iniciar Indexaci√≥n" name="action_start_indexation" type="object" class="btn-success" invisible="indexation_started"/>
                    <button string="üìä Estado de Elasticsearch" name="action_check_elasticsearch_status" type="object" class="btn-secondary"/>
                    <button string="üîÑ Reiniciar" name="action_reset" type="object" class="btn-warning" invisible="not indexation_completed"/>
                    <field name="indexation_started" invisible="1"/>
                    <field name="indexation_completed" invisible="1"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>ü§ñ Indexador de Productos para B√∫squeda IA</h1>
                        <p>Generar embeddings y almacenarlos en Elasticsearch para b√∫squeda inteligente</p>
                    </div>
                    
                    <group>
                        <group string="‚öôÔ∏è Configuraciones de Indexaci√≥n">
                            <field name="index_type"/>
                            <field name="category_id" invisible="index_type != 'category'" required="index_type == 'category'"/>
                            <field name="custom_domain" invisible="index_type != 'custom'" required="index_type == 'custom'"/>
                            <field name="max_products"/>
                            <field name="batch_size"/>
                        </group>
                        
                        <group string="üìä Resultados de la Indexaci√≥n" invisible="not indexation_started">
                            <field name="total_found" readonly="1"/>
                            <field name="total_indexed" readonly="1"/>
                            <field name="total_failed" readonly="1"/>
                            <field name="indexation_time" readonly="1"/>
                            <field name="indexation_rate" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook invisible="not indexation_started">
                        <page string="üìã Registro de Progreso" name="progress_log">
                            <field name="progress_log" nolabel="1" readonly="1" widget="text"/>
                        </page>
                        <page string="‚ùå Detalles de Errores" name="error_details" invisible="not error_details">
                            <field name="error_details" nolabel="1" readonly="1" widget="text"/>
                        </page>
                    </notebook>
                    
                    <div class="mt32" invisible="indexation_started">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="alert alert-info">
                                    <h4><i class="fa fa-info-circle"/> C√≥mo Funciona la Indexaci√≥n</h4>
                                    <ol class="mb-0">
                                        <li><strong>Selecci√≥n de Productos:</strong> Elija qu√© productos indexar usando los filtros</li>
                                        <li><strong>Previsualizaci√≥n:</strong> Vea cu√°ntos y cu√°les productos ser√°n procesados</li>
                                        <li><strong>Generaci√≥n de Embeddings:</strong> El sistema crear√° representaciones vectoriales usando OpenAI</li>
                                        <li><strong>Almacenamiento:</strong> Los embeddings se guardan en Elasticsearch</li>
                                        <li><strong>B√∫squeda IA:</strong> Permite b√∫squedas en lenguaje natural</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="alert alert-success">
                                    <h4><i class="fa fa-lightbulb-o"/> Tipos de Indexaci√≥n</h4>
                                    <ul class="mb-0">
                                        <li><strong>Todos los Productos:</strong> Indexa todos los productos (activos e inactivos) que sean vendibles</li>
                                        <li><strong>Productos Publicados:</strong> Solo productos visibles en el sitio</li>
                                        <li><strong>Por Categor√≠a:</strong> Filtra por una categor√≠a espec√≠fica</li>
                                        <li><strong>Dominio Personalizado:</strong> Use filtros avanzados de Odoo</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-warning">
                                    <h4><i class="fa fa-clock-o"/> Consideraciones de Rendimiento</h4>
                                    <ul class="mb-0">
                                        <li><strong>Tiempo:</strong> ~5-10 productos por minuto (depende de OpenAI)</li>
                                        <li><strong>Costo:</strong> Cada producto genera una solicitud a OpenAI</li>
                                        <li><strong>Lotes:</strong> Procesamiento por lotes evita timeout</li>
                                        <li><strong>L√≠mite:</strong> Comience con pocos productos para prueba</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- A√ß√£o do Indexador -->
    <record id="action_product_ai_search_indexer" model="ir.actions.act_window">
    <field name="name">ü§ñ Indexador de Productos IA</field>
        <field name="res_model">product.ai.search.indexer</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>
</odoo>
