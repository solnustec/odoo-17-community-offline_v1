<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="prescription_upload_form" name="Upload de Receita Médica">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container mt-4">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h3 class="mb-0">
                                        <i class="fa fa-upload mr-2"></i>
                                        Análise de Receita Médica
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <strong>Instruções:</strong>
                                        <ul class="mb-0 mt-2">
                                            <li>Suba uma imagem clara da receita médica</li>
                                            <li>Formatos aceitos: JPEG, PNG, WEBP</li>
                                            <li>Tamanho máximo: 20MB</li>
                                            <li>A IA analisará a receita e buscará produtos correspondentes</li>
                                        </ul>
                                    </div>

                                    <form id="prescriptionForm" enctype="multipart/form-data">
                                        <div class="form-group">
                                            <label for="prescription_image">
                                                <strong>Selecionar Imagem da Receita:</strong>
                                            </label>
                                            <input type="file" 
                                                   class="form-control-file" 
                                                   id="prescription_image" 
                                                   name="prescription_image" 
                                                   accept="image/jpeg,image/jpg,image/png,image/webp" 
                                                   required="required"/>
                                        </div>

                                        <div class="form-group">
                                            <label for="top_k">
                                                <strong>Máximo de produtos por medicamento:</strong>
                                            </label>
                                            <select class="form-control" id="top_k" name="top_k">
                                                <option value="5">5 produtos</option>
                                                <option value="10" selected="selected">10 produtos</option>
                                                <option value="15">15 produtos</option>
                                                <option value="20">20 produtos</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <div class="form-check">
                                                <input type="checkbox" 
                                                       class="form-check-input" 
                                                       id="analysis_only" 
                                                       name="analysis_only" 
                                                       value="true"/>
                                                <label class="form-check-label" for="analysis_only">
                                                    Apenas analisar receita (não buscar produtos)
                                                </label>
                                            </div>
                                        </div>

                                        <div class="form-group text-center">
                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fa fa-search mr-2"></i>
                                                Analisar Receita
                                            </button>
                                        </div>
                                    </form>

                                    <!-- Progress bar -->
                                    <div id="progressContainer" class="d-none">
                                        <div class="progress mb-3">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                                 role="progressbar" 
                                                 style="width: 0%">
                                            </div>
                                        </div>
                                        <div id="progressText" class="text-center">
                                            Processando...
                                        </div>
                                    </div>

                                    <!-- Resultados -->
                                    <div id="results" class="mt-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script type="text/javascript">
                $(document).ready(function() {
                    $('#prescriptionForm').on('submit', function(e) {
                        e.preventDefault();
                        alert('Funcionalidade em desenvolvimento. Configure primeiro a chave OpenAI nos parâmetros do sistema.');
                    });
                });
            </script>
        </t>
    </template>
</odoo>
