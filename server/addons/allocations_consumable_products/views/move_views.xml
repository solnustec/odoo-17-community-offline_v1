<odoo>
    <!-- AcciÃ³n para abrir los movimientos -->
    <record id="action_consumable_move" model="ir.actions.act_window">
        <field name="name">Movimientos de Productos</field>
        <field name="res_model">allocations.consumable.move</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Vista Tree -->
    <!-- Vista Tree -->
    <record id="view_consumable_move_tree" model="ir.ui.view">
        <field name="name">allocations.consumable.move.tree</field>
        <field name="model">allocations.consumable.move</field>
        <field name="arch" type="xml">
            <tree decoration-success="status_change == 'created'"
                  decoration-warning="status_change == 'modified'"
                  decoration-danger="status_change == 'canceled'">

                <field name="name"/>
                <field name="date"/>
                <field name="warehouse_id"/>
                <field name="state" string="Estado"/>
                <field name="status_change" string="Modificado"/>
                <field name="create_uid" readonly="1" string="Responsable"/>
            </tree>
        </field>
    </record>

    <record id="view_consumable_move_line_tree" model="ir.ui.view">
        <field name="name">allocations.consumable.move.line.tree</field>
        <field name="model">allocations.consumable.move.line</field>
        <field name="arch" type="xml">
            <tree>
                <field name="move_id" string="Movimiento"/>
                <field name="move_date" string="Fecha"/>
                <field name="product_id" string="Producto"/>
                <field name="qty_required" string="Cantidad"/>
                <field name="warehouse_id" string="Destino"/>
            </tree>
        </field>
    </record>


    <!-- Vista Form corregida para Odoo 17 -->
    <!-- Vista Form -->
    <record id="view_consumable_move_form" model="ir.ui.view">
        <field name="name">allocations.consumable.move.form</field>
        <field name="model">allocations.consumable.move</field>
        <field name="arch" type="xml">
            <form string="Movimiento de Productos">
                <header>

                    <!-- ðŸ‘‡ CAMPO DEBE IR ANTES DE LOS BOTONES -->
                    <field name="sent_to_visual" invisible="1"/>

                    <button name="action_confirm"
                            type="object"
                            string="Confirmar"
                            class="btn-primary"
                            invisible="state != 'draft'"/>

                    <button name="action_cancel"
                            type="object"
                            string="Cancelar"
                            class="btn-danger"/>

                    <button name="action_send_visual"
                            string="Enviar a Visual"
                            type="object"
                            class="btn-primary"/>

                    <field name="state" widget="statusbar" statusbar_visible="draft,done"/>

                </header>


                <sheet>
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="date"/>
                            <field name="warehouse_id" options="{'no_create_edit': True}"/>
                            <field name="status_change" readonly="1"/> <!-- âœ”ï¸ Mostrar estado -->
                        </group>
                    </group>

                    <notebook>
                        <page string="LÃ­neas">
                            <field name="line_ids">
                                <tree editable="bottom">
                                    <field name="product_id"/>
                                    <field name="qty_required"/>
                                    <field name="allocation_note" readonly="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>

            </form>
        </field>
    </record>


    <!-- ðŸ“¦ MenÃº -->
    <menuitem id="menu_consumable_move"
              name="Movimientos"
              parent="menu_root_consumable_products"
              action="action_consumable_move"
              sequence="20"/>
</odoo>
